<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ROOMATCH - Log In</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #fde2f3 0%, #e0d9ff 50%, #f3e8ff 100%);
      background-attachment: fixed;
      background-repeat: no-repeat;
      background-size: cover;
      position: relative;
      min-height: 100vh;
      overflow: hidden;
    }

    .wave {
      position: absolute;
      width: 200%;
      height: 100%;
      left: 50%;
      top: 0;
      transform: translateX(-50%);
      background-repeat: repeat-x;
      background-size: cover;
      opacity: 0.5;
      z-index: 1;
    }

    .wave1 {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23f8bbd0" fill-opacity="1" d="M0,32L40,37.3C80,43,160,53,240,80C320,107,400,149,480,165.3C560,181,640,171,720,165.3C800,160,880,160,960,170.7C1040,181,1120,203,1200,197.3C1280,192,1360,160,1400,144L1440,128L1440,0L1400,0C1360,0,1280,0,1200,0C1120,0,1040,0,960,0C880,0,800,0,720,0C640,0,560,0,480,0C400,0,320,0,240,0C160,0,80,0,40,0L0,0Z"></path></svg>');
      animation: waveMove 12s ease-in-out infinite;
      opacity: 0.4;
    }

    @keyframes waveMove {
      0% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-48%) translateY(10px); }
      100% { transform: translateX(-50%) translateY(0); }
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.18);
      border: 1.5px solid rgba(162, 59, 177, 0.13);
    }

    .border-gradient-anim {
      pointer-events: none;
      border-radius: 1.25rem;
      background: linear-gradient(120deg, #fde2f3, #a23bb1 60%, #e0d9ff 100%);
      opacity: 0.5;
      filter: blur(8px);
      animation: borderAnim 6s linear infinite alternate;
    }

    @keyframes borderAnim {
      0% { opacity: 0.5; filter: blur(8px); }
      100% { opacity: 0.8; filter: blur(16px); }
    }

    .content {
      position: relative;
      z-index: 10;
    }

    .error-message {
      color: #dc2626;
      font-size: 0.875rem;
      margin-top: 0.5rem;
      text-align: left;
    }
  </style>
</head>

<body class="flex items-center justify-center px-6 py-20">

  <!-- Background Wave -->
  <div class="wave wave1"></div>

  <!-- Content Card -->
  <div class="content max-w-md w-full text-center relative">
    <div class="relative rounded-xl glass-card px-8 py-12 z-10">
      <div class="absolute -inset-1 rounded-xl z-0 border-gradient-anim"></div>

      <!-- Title -->
      <h1 class="text-3xl font-bold text-gray-800 mb-6 z-10 relative">Log In to Roomatch</h1>

      <!-- Login Form -->
      <form id="loginForm" class="space-y-6 z-10 relative">
        <!-- Email -->
        <div class="text-left">
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <input type="email" id="email" name="email" placeholder="Enter your email"
            class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500" required />
        </div>

        <!-- Password -->
        <div class="text-left">
          <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
          <input type="password" id="password" name="password" placeholder="Enter your password"
            class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500" required />
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message hidden"></div>

        <!-- Submit Button -->
        <button type="submit"
          class="w-full bg-gradient-to-r from-purple-500 via-pink-400 to-purple-700 hover:from-purple-700 hover:to-pink-500 text-white py-3 rounded-xl text-base font-semibold transform transition duration-200 hover:scale-105 hover:shadow-2xl shadow">
          Log In
        </button>
      </form>

      <!-- Back Link -->
      <div class="mt-6 z-10 relative">
        <a href="index.html" onclick="window.location.href='index.html'; return false;" class="text-purple-600 hover:text-purple-800 text-sm font-medium">‚Üê Back to Home</a>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-10 text-gray-600 text-base opacity-90 z-10 relative">
      Made with <span style="font-size:1.3em;">üíñ</span> by Roomatch &copy; 2025
    </footer>
  </div>

  <!-- Place these scripts at the end of <body> for correct order -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Use a different variable name for your client
    const supabaseClient = window.supabase.createClient(
      'https://vgkvkmpckneceqfggzes.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZna3ZrbXBja25lY2VxZmdnemVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1NDA0NjAsImV4cCI6MjA2MjExNjQ2MH0.1ZEMsUleNaBrePUuagdZAKL2gYA-9-vM9wrTIW8-tdU'
    );

    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      const errorMessage = document.getElementById('errorMessage');
      const submitButton = this.querySelector('button[type=\"submit\"]');

      // Disable button and show loading state
      submitButton.disabled = true;
      submitButton.textContent = 'Logging in...';

      try {
        // Query the users table for the email
        const { data: userData, error: userError } = await supabaseClient
          .from('users')
          .select('id, email, password_hash, user_type')
          .eq('email', email)
          .single();

        console.log('userData:', userData);
        console.log('userError:', userError);

        if (userError) {
          throw new Error('User not found');
        }

        // Check if password_hash matches
        if (userData && userData.password_hash === password) {
          // Store user ID in localStorage for future use
          localStorage.setItem('user_id', userData.id);
          // Redirect based on user_type
          if (userData.user_type === 'Looking for Apt') {
            window.location.href = 'apt-feed.html';
          } else if (userData.user_type === 'Looking for Roomate') {
            window.location.href = 'roomate.html';
          } else {
            // Fallback: show error if user_type is not recognized
            errorMessage.textContent = 'Unknown user type. Please contact support.';
            errorMessage.classList.remove('hidden');
          }
        } else {
          // Invalid password
          errorMessage.textContent = 'Invalid email or password';
          errorMessage.classList.remove('hidden');
        }
      } catch (error) {
        console.error('Login error:', error);
        errorMessage.textContent = 'Invalid email or password';
        errorMessage.classList.remove('hidden');
      } finally {
        // Re-enable button and restore text
        submitButton.disabled = false;
        submitButton.textContent = 'Log In';
      }
    });
  </script>

</body>

</html>
